<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - KisanAI Live</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="js/translations.js"></script>
    <script src="js/utils.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <button class="mobile-nav-toggle" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-logo">
                <i class="fas fa-leaf"></i> KisanAI <span>Live</span>
            </div>
            <ul class="sidebar-menu">
                <li><a href="dashboard.html" class="active"><i class="fas fa-home"></i> <span data-i18n="dashboard">Dashboard</span></a></li>
                <li><a href="scan.html"><i class="fas fa-camera"></i> <span data-i18n="scan_crop">Scan Crop</span></a></li>
                <li><a href="chat.html"><i class="fas fa-comments"></i> <span data-i18n="ai_advisor">AI Advisor</span></a></li>
                <li><a href="recommendations.html"><i class="fas fa-seedling"></i> <span data-i18n="recommendations">Recommendations</span></a></li>
                <li><a href="history.html"><i class="fas fa-history"></i> <span data-i18n="history">History</span></a></li>
                <li><a href="profile.html"><i class="fas fa-user"></i> <span data-i18n="profile">Profile</span></a></li>
            </ul>
            
            <div style="margin-top: auto; padding: 20px; background: #f0f4f8; border-radius: 12px; text-align: center;">
                <p style="font-size: 0.8rem; color: #666; margin-bottom: 5px;">Cloud Status</p>
                <div class="badge mongodb" style="justify-content: center; font-size: 0.7rem; padding: 5px 10px;">
                    <i class="fas fa-database"></i> MongoDB Connected
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="dashboard-banner">
                <div>
                    <h1 data-i18n="dashboard">Your AI Farming Dashboard</h1>
                    <p id="welcome-msg" data-i18n="welcome">Welcome back! Your crops are looking healthy today.</p>
                </div>
                <div style="text-align: right;">
                    <span style="background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px;" id="weather-widget">
                        <i class="fas fa-cloud-sun"></i> Loading Weather...
                    </span>
                </div>
            </div>

            <div class="section-title" style="text-align: left; margin-bottom: 30px;">
                <h2 data-i18n="quick_actions">Quick Actions</h2>
            </div>

            <div class="action-cards">
                <a href="scan.html" class="action-card">
                    <div class="action-icon" style="color: var(--primary-color);">
                        <i class="fas fa-camera"></i>
                    </div>
                    <h3 data-i18n="scan_crop">Scan Crop</h3>
                    <p style="color: #666; font-size: 0.9rem;" data-i18n="scan_desc">Analyze crop health using KisanAI Vision</p>
                </a>

                <a href="chat.html" class="action-card">
                    <div class="action-icon" style="color: var(--accent-color);">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h3 data-i18n="ask_advisor">Ask KisanAI Advisor</h3>
                    <p style="color: #666; font-size: 0.9rem;" data-i18n="advisor_desc">Get instant farming advice via Chat</p>
                </a>

                <a href="history.html" class="action-card">
                    <div class="action-icon" style="color: #4DB33D;">
                        <i class="fas fa-history"></i>
                    </div>
                    <h3 data-i18n="view_history">View History</h3>
                    <p style="color: #666; font-size: 0.9rem;" data-i18n="history_desc">Access past records from MongoDB</p>
                </a>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
                <!-- Weather Section -->
                <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: var(--card-shadow);">
                    <h3 style="margin-bottom: 15px;" data-i18n="weather">Weather Forecast</h3>
                    <div id="weather-details" style="display: flex; justify-content: space-around; text-align: center;">
                        <div>
                            <i class="fas fa-temperature-high" style="color: orange; font-size: 1.5rem;"></i>
                            <p id="temp-val">--°C</p>
                        </div>
                        <div>
                            <i class="fas fa-wind" style="color: grey; font-size: 1.5rem;"></i>
                            <p id="wind-val">-- km/h</p>
                        </div>
                        <div>
                            <i class="fas fa-tint" style="color: blue; font-size: 1.5rem;"></i>
                            <p id="humidity-val">--%</p>
                        </div>
                    </div>
                </div>

                <!-- Market Price Section -->
                <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: var(--card-shadow);">
                    <h3 style="margin-bottom: 15px;" data-i18n="market_price">Market Prices</h3>
                    <table style="width: 100%; font-size: 0.9rem;">
                        <thead style="background: #f8f9fa;">
                            <tr>
                                <th style="padding: 8px; text-align: left;">Crop</th>
                                <th style="padding: 8px; text-align: right;">Price (₹/qt)</th>
                                <th style="padding: 8px; text-align: center;">Trend</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 8px;">Rice (Basmati)</td>
                                <td style="padding: 8px; text-align: right;">3,800</td>
                                <td style="padding: 8px; text-align: center; color: green;"><i class="fas fa-arrow-up"></i></td>
                            </tr>
                            <tr>
                                <td style="padding: 8px;">Wheat</td>
                                <td style="padding: 8px; text-align: right;">2,125</td>
                                <td style="padding: 8px; text-align: center; color: red;"><i class="fas fa-arrow-down"></i></td>
                            </tr>
                            <tr>
                                <td style="padding: 8px;">Cotton</td>
                                <td style="padding: 8px; text-align: right;">6,200</td>
                                <td style="padding: 8px; text-align: center; color: green;"><i class="fas fa-arrow-up"></i></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="section-title" style="text-align: left; margin-bottom: 20px; margin-top: 30px;">
                <h2 data-i18n="weather_alert">Recent Alerts</h2>
            </div>
            
            <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: var(--card-shadow); border-left: 5px solid #FFC107;">
                <h4 style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-exclamation-triangle" style="color: #FFC107;"></i> <span data-i18n="weather_alert">Weather Alert</span>
                </h4>
                <p style="color: #666; margin-top: 5px;">Heavy rain expected in your region tomorrow. Ensure proper drainage for your paddy fields.</p>
                <div style="margin-top: 10px; font-size: 0.8rem; color: #888;" data-i18n="powered_by">Powered by KisanAI</div>
            </div>

            <footer style="text-align: center; padding: 20px; margin-top: 30px; color: #666; font-size: 0.9rem;">
                &copy; 2026 KisanAI Live.
            </footer>
        </main>
    </div>
    <script>
        const userName = localStorage.getItem('user_name');
        if (userName) {
            // Translation script handles this now, but we set the fallback
        }
        
        // Simple authentication check
        const userId = localStorage.getItem('user_id');
        if (!userId) {
            window.location.href = 'login.html';
        }

        // Fetch Weather (Mocking location to Delhi for now)
        async function fetchWeather() {
            try {
                const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=28.61&longitude=77.20&current_weather=true');
                const data = await response.json();
                if (data.current_weather) {
                    const temp = data.current_weather.temperature;
                    const wind = data.current_weather.windspeed;
                    document.getElementById('weather-widget').innerHTML = `<i class="fas fa-cloud-sun"></i> ${temp}°C`;
                    document.getElementById('temp-val').textContent = `${temp}°C`;
                    document.getElementById('wind-val').textContent = `${wind} km/h`;
                    // Open-Meteo free doesn't give humidity in current_weather easily without hourly, keeping mock for humidity
                    document.getElementById('humidity-val').textContent = "45%"; 
                }
            } catch (e) {
                console.error("Weather fetch failed", e);
            }
        }
        fetchWeather();
    </script>
</body>
</html>
